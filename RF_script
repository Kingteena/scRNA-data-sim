## Simulation project reviewing through and generating RF distances

# 1. Loading in any required libraries into current workspace 
conda install r-ape
conda install r-TreeDist
conda install r-ggplot2

# 2. Loading in the two trees, true_tree (cellcoal) and inferred_tree (cellphy)
true_tree <- read.tree("/hpcfs/groups/phoenix-hpc-gavryushkina/simulation/output/cellcoal/tree_files/trees.0003")
inferred_tree <- read.tree("/hpcfs/groups/phoenix-hpc-gavryushkina/simulation/output/cellcoal/nicked/nicked_0003.vcf")

# 3. Removing a "cell" prefix from CellCoal labels
# Removing a "tumecell" prefix from CellPhy labels
true_tree$tip.label <- gsub("cell", "", true_tree$tip.label)
inferred_tree$tip.label <- gsub("tumcell", "", inferred_tree$tip.label)

# 4. Finding common tips between trees
common_tips <- intersect(true_tree$tip.label, inferred_tree$tip.label)

# 5. Ensure both trees only include those common tips (removing outgroup)
true_tree <- keep.tip(true_tree, common_tips)
inferred_tree <- keep.tip(inferred_tree, common_tips)

# 6. Calculating the Generalized RF distance (MCI) and other metrics
tree_dist <- TreeDistance(unroot(true_tree), inferred_tree)

# Ignoring the branch lengths of inferred _tree to visualise phylogen better 
inferred_tree$edge.length <- NULL

# 7. Calculating and storing Genralised RF distance between the trees 
Gen_rf_dist <- print(paste("Normalized GRF Distance:", round(tree_dist, 3)))

ggsave("treeplot0003.svg")

# 8. Visualising the 2 trees side by side in regards to there sites of similarity
treeplot0003 <- VisualizeMatching(
  Func = ClusteringInfoDistance, 
  tree1 = true_tree, 
  tree2 = inferred_tree,
  setPar = TRUE,
  precision = 3L,
  Plot = plot.phylo,
  matchZeros = TRUE,
  plainEdges = FALSE,,
  edge.frame = "rect",
  edge.width = 2,
  edge.color = "black",
)

# Aesthetic commands for final tree output 
# Adding a title at the top of plot 
title(main = "Comparison Between True (CellCoal) vs. Inferred (CellPhy) Trees")

# Adding text to specific areas (the coordinates are relative to the plot axes)
text(x = 0.5, y = 1.05, "Blue lines = Stronger Matching", col = "blue", cex = 0.8)


dev.off()